<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blue Wallet</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f8fafc; color: #1e293b; margin: 0; min-height: 100vh; display: flex; flex-direction: column; }
        #toggle-btn { position: fixed; top: 16px; left: 16px; width: 48px; height: 48px; background: #3b82f6; color: white; border: none; border-radius: 14px; font-size: 28px; cursor: pointer; z-index: 30; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 14px rgba(0,0,0,0.15); transition: background 0.2s; }
        #toggle-btn:hover { background: #2563eb; }
        header { background: #ffffff; box-shadow: 0 4px 14px rgba(0,0,0,0.08); position: sticky; top: 0; z-index: 10; transition: transform 0.3s ease; transform: translateY(-100%); }
        header.visible { transform: translateY(0); }
        #top-bar { display: flex; justify-content: center; align-items: center; padding: 18px; gap: 14px; flex-wrap: wrap; }
        #top-bar button { min-width: 130px; padding: 14px 24px; background: #3b82f6; color: white; border: none; border-radius: 14px; font-weight: bold; cursor: pointer; font-size: 15px; transition: all 0.2s; }
        #top-bar button:hover, #top-bar button.active { background: #2563eb; transform: translateY(-3px); box-shadow: 0 6px 12px rgba(37,99,235,0.3); }
        main { flex: 1; padding: 20px; padding-top: 80px; }
        .tab { max-width: 1000px; margin: 0 auto; background: #ffffff; border-radius: 24px; box-shadow: 0 12px 32px rgba(0,0,0,0.1); padding: 36px; display: none; }
        #wallet { display: block; }
        #total-card { text-align: center; background: linear-gradient(135deg, #eef2ff, #e0e7ff); border-radius: 24px; padding: 48px; margin-bottom: 36px; box-shadow: 0 8px 24px rgba(0,0,0,0.1); }
        #total-label { font-size: 20px; color: #64748b; }
        #total-amount { font-size: 56px; font-weight: 800; color: #2563eb; margin: 16px 0; }
        #currency-select { padding: 12px 18px; background: #ffffff; border: 1px solid #bfdbfe; border-radius: 14px; font-size: 18px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        #assets { list-style: none; padding: 0; margin: 0; display: grid; gap: 16px; }
        #assets li { display: flex; align-items: center; gap: 24px; padding: 28px; background: #f0f9ff; border-radius: 20px; transition: all 0.3s; }
        #assets li:hover { transform: translateY(-6px); box-shadow: 0 8px 20px rgba(0,0,0,0.12); }
        .asset-logo { width: 64px; height: 64px; border-radius: 50%; object-fit: contain; background: white; padding: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .asset-info { flex: 1; }
        .asset-symbol { font-size: 28px; font-weight: bold; color: #2563eb; }
        .asset-details { font-size: 18px; color: #475569; margin-top: 4px; }
        .form-grid { display: grid; gap: 24px; }
        label { font-weight: 600; color: #3b82f6; font-size: 17px; }
        input, select { padding: 16px; background: #f8fbff; border: 1px solid #bfdbfe; border-radius: 14px; font-size: 17px; transition: all 0.2s; }
        input:focus, select:focus { border-color: #2563eb; box-shadow: 0 0 0 4px rgba(37,99,235,0.25); outline: none; }
        button.action { padding: 16px 32px; background: #10b981; color: white; border: none; border-radius: 14px; font-weight: bold; font-size: 18px; cursor: pointer; transition: all 0.2s; box-shadow: 0 6px 14px rgba(16,185,129,0.3); width: 100%; }
        button.action:hover { background: #059669; transform: translateY(-4px); }
        .info-box { background: #eff6ff; padding: 18px; border-radius: 14px; font-weight: 600; color: #2563eb; font-size: 18px; text-align: center; }
        #lev-range { display: flex; align-items: center; gap: 12px; }
        #lev-value { font-size: 24px; font-weight: bold; color: #2563eb; min-width: 60px; text-align: right; }
        h2 { color: #2563eb; font-size: 28px; text-align: center; margin-bottom: 32px; font-weight: 700; }
        #manage-trades li { background: #f0f9ff; padding: 32px; border-radius: 20px; margin-bottom: 24px; transition: all 0.3s; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        #manage-trades li:hover { transform: translateY(-6px); box-shadow: 0 12px 28px rgba(0,0,0,0.15); }
        .trade-header { font-size: 24px; font-weight: bold; color: #2563eb; margin-bottom: 16px; }
        .trade-detail { font-size: 18px; margin: 8px 0; }
        .pnl-positive { color: #10b981; }
        .pnl-negative { color: #ef4444; }
        footer { padding: 28px; text-align: center; }
        .secret { padding: 14px 36px; background: #2563eb; color: white; font-size: 17px; font-weight: bold; border: none; border-radius: 30px; cursor: pointer; box-shadow: 0 6px 14px rgba(37,99,235,0.3); }
        #secret-section { padding: 28px; background: #eff6ff; border-radius: 20px; margin-top: 24px; display: none; }
        @media (max-width: 768px) {
            main { padding-top: 90px; padding: 16px; }
            #total-amount { font-size: 48px; }
            h2 { font-size: 24px; }
            .tab { padding: 24px; }
            .asset-logo { width: 56px; height: 56px; }
        }
        @media (max-width: 480px) {
            #top-bar button { min-width: 100px; font-size: 14px; padding: 12px 18px; }
            #total-amount { font-size: 40px; }
        }
    </style>
</head>
<body>
    <button id="toggle-btn">☰</button>
    <header id="header">
        <div id="top-bar">
            <button onclick="showTab('wallet')" class="active">Wallet</button>
            <button onclick="showTab('trade')">Trade</button>
            <button onclick="showTab('manage')">Manage</button>
            <button onclick="showTab('transfer')">Swap</button>
            <button onclick="showTab('history')">History</button>
        </div>
    </header>

    <main>
        <div id="wallet" class="tab">
            <div id="total-card">
                <div id="total-label">Portfolio Value</div>
                <div id="total-amount">Loading...</div>
                <select id="currency-select">
                    <option value="USD">$ USD</option>
                    <option value="EUR">€ EUR</option>
                    <option value="GBP">£ GBP</option>
                    <option value="AED">د.إ AED</option>
                    <option value="JPY">¥ JPY</option>
                    <option value="CNY">¥ CNY</option>
                </select>
            </div>
            <ul id="assets"></ul>
        </div>

        <div id="trade" class="tab">
            <h2>Open Long Trade</h2>
            <div class="form-grid">
                <div>
                    <label>Pair</label>
                    <input id="trade-crypto" list="cryptos" placeholder="e.g. BTC">
                </div>
                <div id="current-price" class="info-box"></div>
                <div>
                    <label>USDT Amount</label>
                    <input id="usdt-amount" type="number" step="any" min="0" placeholder="0.00">
                    <div id="available-usdt" class="info-box"></div>
                </div>
                <div>
                    <label>Leverage</label>
                    <div id="lev-range">
                        <input id="leverage" type="range" min="1" max="100" value="1" style="flex:1;">
                        <span id="lev-value">1x</span>
                    </div>
                </div>
                <button class="action" id="trade-btn">Open Trade</button>
                <div id="liq-est" class="info-box"></div>
            </div>
        </div>

        <div id="manage" class="tab">
            <h2>Open Trades</h2>
            <ul id="manage-trades"></ul>
        </div>

        <div id="transfer" class="tab">
            <h2>Swap Assets</h2>
            <div class="form-grid">
                <div>
                    <label>From</label>
                    <select id="from-crypto"></select>
                    <div id="from-balance" class="info-box"></div>
                </div>
                <div>
                    <label>To</label>
                    <select id="to-crypto"></select>
                </div>
                <div>
                    <label>Amount</label>
                    <input id="transfer-amount" type="number" step="any" min="0">
                    <div id="transfer-est" class="info-box"></div>
                </div>
                <button class="action" id="swap-btn">Swap (0.5% fee)</button>
            </div>
        </div>

        <div id="history" class="tab">
            <h2>Trading History</h2>
            <ul id="history-list"></ul>
        </div>
    </main>

    <footer>
        <button id="secret-btn" class="secret">About Me</button>
        <div id="secret-section">
            <h2>Add Asset</h2>
            <label>Symbol</label>
            <input id="crypto-type" list="cryptos" placeholder="BTC">
            <label>Amount</label>
            <input id="amount" type="number" step="any" min="0">
            <button class="action" id="add-btn">Add</button>
        </div>
    </footer>

    <datalist id="cryptos">
        <option value="BTC"><option value="ETH"><option value="SOL"><option value="USDT">
        <option value="ADA"><option value="XRP"><option value="BNB"><option value="DOGE">
        <option value="DOT"><option value="LINK">
    </datalist>

    <script>
        let assets = JSON.parse(localStorage.getItem('assets')) || { USDT: 10000 };
        let trades = JSON.parse(localStorage.getItem('trades')) || [];
        let history = JSON.parse(localStorage.getItem('history')) || [];
        let prices = { USDT: 1 };
        let fiatRates = { usd: 1 };
        let displayCurrency = 'USD';

        const currencySymbols = { USD: '$', EUR: '€', GBP: '£', AED: 'د.إ', JPY: '¥', CNY: '¥' };

        const symbolToId = {
            BTC: 'bitcoin', ETH: 'ethereum', SOL: 'solana', USDT: 'tether',
            ADA: 'cardano', XRP: 'ripple', BNB: 'binancecoin', DOGE: 'dogecoin',
            DOT: 'polkadot-new', LINK: 'chainlink'
        };

        async function fetchPrices(symbols) {
            const needed = symbols.filter(s => s !== 'USDT' && !prices[s]);
            if (needed.length === 0) return;
            const ids = needed.map(s => symbolToId[s] || s.toLowerCase()).join(',');
            try {
                const res = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=' + ids + '&vs_currencies=usd');
                const data = await res.json();
                needed.forEach(s => {
                    const id = symbolToId[s] || s.toLowerCase();
                    if (data[id]?.usd) prices[s] = data[id].usd;
                });
            } catch (err) {}
        }

        async function fetchFiatRates() {
            try {
                const res = await fetch('https://cdn.jsdelivr.net/npm/@fawazahmed0/currency-api@latest/v1/currencies/usd.json');
                const data = await res.json();
                fiatRates = data.usd;
            } catch (err) {}
        }

        function save() {
            localStorage.setItem('assets', JSON.stringify(assets));
            localStorage.setItem('trades', JSON.stringify(trades));
            localStorage.setItem('history', JSON.stringify(history));
        }

        function getTotalUSD() {
            let total = 0;
            for (const c in assets) {
                if (assets[c] > 0) total += assets[c] * (prices[c] || 0);
            }
            return total;
        }

        function updateTotal() {
            const totalUSD = getTotalUSD();
            const rate = fiatRates[displayCurrency.toLowerCase()] || 1;
            const total = totalUSD * rate;
            document.getElementById('total-amount').innerText = currencySymbols[displayCurrency] + total.toFixed(2);
        }

        function updateAssets() {
            const list = document.getElementById('assets');
            list.innerHTML = '';
            Object.keys(assets).sort().forEach(c => {
                if (assets[c] <= 0) return;
                const id = symbolToId[c] || c.toLowerCase();
                const valueUSD = prices[c] ? (assets[c] * prices[c]).toFixed(2) : '0.00';
                const li = document.createElement('li');
                li.innerHTML = `
                    <img src="https://cryptologos.cc/logos/\( {id}- \){c.toLowerCase()}-logo.png?v=029" class="asset-logo" onerror="this.style.display='none'">
                    <div class="asset-info">
                        <div class="asset-symbol">${c}</div>
                        <div class="asset-details">${assets[c].toFixed(8)} ≈ \[ {valueUSD}</div>
                    </div>`;
                list.appendChild(li);
            });
        }

        function refresh() {
            updateTotal();
            updateAssets();
            const active = document.querySelector('.tab[style*="block"]')?.id;
            if (active === 'trade') updateTrade();
            if (active === 'manage') updateManage();
            if (active === 'transfer') updateSwap();
            if (active === 'history') updateHistory();
        }

        function showTab(id) {
            document.querySelectorAll('.tab').forEach(t => t.style.display = 'none');
            document.getElementById(id).style.display = 'block';
            document.querySelectorAll('#top-bar button').forEach(b => b.classList.remove('active'));
            document.querySelector(`#top-bar button[onclick="showTab('${id}')"]`).classList.add('active');
            refresh();
        }

        document.getElementById('toggle-btn').onclick = () => {
            const header = document.getElementById('header');
            header.classList.toggle('visible');
            document.getElementById('toggle-btn').innerText = header.classList.contains('visible') ? '✖' : '☰';
        };

        document.getElementById('currency-select').onchange = (e) => {
            displayCurrency = e.target.value.trim().split(' ')[1] || e.target.value;
            updateTotal();
        };

        document.getElementById('secret-btn').onclick = () => {
            const sec = document.getElementById('secret-section');
            sec.style.display = sec.style.display === 'block' ? 'none' : 'block';
        };

        document.getElementById('add-btn').onclick = async () => {
            const sym = document.getElementById('crypto-type').value.toUpperCase().trim();
            const amt = parseFloat(document.getElementById('amount').value);
            if (sym && amt > 0) {
                assets[sym] = (assets[sym] || 0) + amt;
                save();
                await fetchPrices([sym]);
                refresh();
                document.getElementById('secret-section').style.display = 'none';
                document.getElementById('amount').value = '';
                document.getElementById('crypto-type').value = '';
            }
        };

        async function updateTrade() {
            document.getElementById('available-usdt').innerText = 'Available: ' + (assets.USDT || 0).toFixed(2) + ' USDT';
            const sym = document.getElementById('trade-crypto').value.toUpperCase().trim();
            if (sym) {
                await fetchPrices([sym]);
                document.getElementById('current-price').innerText = prices[sym] ? 'Current Price: $' + prices[sym].toFixed(2) : 'Price not available';
            }
            document.getElementById('lev-value').innerText = document.getElementById('leverage').value + 'x';
        }

        document.getElementById('trade-crypto').oninput = updateTrade;
        document.getElementById('leverage').oninput = updateTrade;

        document.getElementById('trade-btn').onclick = async () => {
            const sym = document.getElementById('trade-crypto').value.toUpperCase().trim();
            const usdt = parseFloat(document.getElementById('usdt-amount').value);
            const lev = parseInt(document.getElementById('leverage').value);
            if (!sym || !usdt || usdt > (assets.USDT || 0)) return;
            await fetchPrices([sym]);
            const price = prices[sym];
            if (!price) return;
            assets.USDT -= usdt;
            const pos = (usdt * lev) / price;
            trades.push({ sym, pos, entry: price, lev });
            save();
            document.getElementById('liq-est').innerText = 'Estimated Liq Price: $' + (price * (1 - 1/lev)).toFixed(2);
            showTab('manage');
        };

        async function updateManage() {
            await fetchPrices(trades.map(t => t.sym));
            const list = document.getElementById('manage-trades');
            list.innerHTML = '';
            trades.forEach((t, i) => {
                const curr = prices[t.sym] || t.entry;
                const pnl = (curr - t.entry) * t.pos;
                const roi = (pnl / (t.pos * t.entry / t.lev)) * 100;
                const liq = (t.entry * (1 - 1/t.lev)).toFixed(2);
                const pnlClass = pnl >= 0 ? 'pnl-positive' : 'pnl-negative';
                const roiClass = roi >= 0 ? 'pnl-positive' : 'pnl-negative';
                const li = document.createElement('li');
                li.innerHTML = `
                    <div class="trade-header">\( {t.sym}/USDT × \){t.lev}</div>
                    <div class="trade-detail">Size: ${t.pos.toFixed(6)}</div>
                    <div class="trade-detail">Entry: \]{t.entry.toFixed(2)} → Current: \[ {curr.toFixed(2)}</div>
                    <div class="trade-detail">Liq Price: \]{liq}</div>
                    <div class="trade-detail">PnL: <span class="${pnlClass}">\[ {pnl.toFixed(2)}</span></div>
                    <div class="trade-detail">ROI: <span class="\( {roiClass}"> \){roi.toFixed(2)}%</span></div>
                    <button class="action" onclick="closeTrade(${i})" style="margin-top:20px;">Close Trade</button>`;
                list.appendChild(li);
            });
        }

        window.closeTrade = async (i) => {
            const t = trades[i];
            await fetchPrices([t.sym]);
            const curr = prices[t.sym] || t.entry;
            const pnl = (curr - t.entry) * t.pos;
            const roi = (pnl / (t.pos * t.entry / t.lev)) * 100;
            assets.USDT = (assets.USDT || 0) + (t.pos * t.entry / t.lev) + pnl;
            history.push({ sym: t.sym, lev: t.lev, pos: t.pos, entry: t.entry, exit: curr, pnl, roi, closeDate: new Date().toISOString() });
            trades.splice(i, 1);
            save();
            refresh();
        };

        function updateHistory() {
            const list = document.getElementById('history-list');
            list.innerHTML = '';
            history.slice().reverse().forEach(h => {
                const pnlClass = h.pnl >= 0 ? 'pnl-positive' : 'pnl-negative';
                const roiClass = h.roi >= 0 ? 'pnl-positive' : 'pnl-negative';
                const li = document.createElement('li');
                li.innerHTML = `
                    <div class="trade-header">\( {h.sym}/USDT × \){h.lev}</div>
                    <div class="trade-detail">Size: ${h.pos.toFixed(6)}</div>
                    <div class="trade-detail">Entry \]{h.entry.toFixed(2)} → Exit \[ {h.exit.toFixed(2)}</div>
                    <div class="trade-detail">PnL: <span class="${pnlClass}"> \]{h.pnl.toFixed(2)}</span></div>
                    <div class="trade-detail">ROI: <span class="\( {roiClass}"> \){h.roi.toFixed(2)}%</span></div>
                    <div class="trade-detail">Closed: ${new Date(h.closeDate).toLocaleString()}</div>`;
                list.appendChild(li);
            });
        }

        function updateSwap() {
            const fromSelect = document.getElementById('from-crypto');
            const toSelect = document.getElementById('to-crypto');
            fromSelect.innerHTML = '';
            toSelect.innerHTML = '';
            Object.keys(prices).sort().forEach(c => {
                const o1 = document.createElement('option'); o1.value = o1.textContent = c; fromSelect.appendChild(o1);
                const o2 = o1.cloneNode(true); toSelect.appendChild(o2);
            });
            estimateSwap();
        }

        function estimateSwap() {
            const from = document.getElementById('from-crypto').value;
            const to = document.getElementById('to-crypto').value;
            const amt = parseFloat(document.getElementById('transfer-amount').value) || 0;
            if (from && to && amt > 0 && prices[from] && prices[to]) {
                const received = (amt * prices[from] * 0.995) / prices[to];
                document.getElementById('transfer-est').innerText = `You receive ≈ ${received.toFixed(8)} ${to}`;
            } else {
                document.getElementById('transfer-est').innerText = '';
            }
            if (from) {
                document.getElementById('from-balance').innerText = `Balance: ${(assets[from] || 0).toFixed(8)} ${from} ($${(assets[from] || 0) * (prices[from] || 0).toFixed(2)})`;
            }
        }

        document.getElementById('from-crypto').onchange = estimateSwap;
        document.getElementById('to-crypto').onchange = estimateSwap;
        document.getElementById('transfer-amount').oninput = estimateSwap;

        document.getElementById('swap-btn').onclick = async () => {
            const from = document.getElementById('from-crypto').value;
            const to = document.getElementById('to-crypto').value;
            const amt = parseFloat(document.getElementById('transfer-amount').value);
            if (from === to || (assets[from] || 0) < amt) return;
            await fetchPrices([from, to]);
            const received = (amt * prices[from] * 0.995) / prices[to];
            assets[from] -= amt;
            if (assets[from] <= 0) delete assets[from];
            assets[to] = (assets[to] || 0) + received;
            save();
            showTab('wallet');
        };

        (async () => {
            await fetchFiatRates();
            const symbols = [...new Set([...Object.keys(assets), ...trades.map(t => t.sym)])];
            await fetchPrices(symbols);
            refresh();
            setInterval(async () => {
                await fetchFiatRates();
                const all = [...new Set([...Object.keys(assets), ...trades.map(t => t.sym)])];
                await fetchPrices(all);
                refresh();
            }, 8000);
        })();
    </script>
</body>
</html>