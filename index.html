<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Exam Hub</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: Arial, sans-serif; background:#eef2f7; margin:0 }
    .container { max-width:1100px; margin:auto; padding:20px }
    h1 { text-align:center }
    .grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:15px }
    .card { background:#fff; padding:20px; border-radius:10px; cursor:pointer; box-shadow:0 4px 10px rgba(0,0,0,.1) }
    .hidden { display:none }
    .btn { padding:8px 14px; border:none; border-radius:6px; cursor:pointer }
    .back { background:#1976d2; color:white; margin-bottom:15px }
    .delete { background:#d32f2f; color:white }
    .add { background:#388e3c; color:white }
    input, textarea { width:100%; margin-bottom:10px; padding:8px }
  </style>
</head>

<body>
<div class="container">

<h1>Exam Hub</h1>

<!-- SEARCH -->
<input id="search" placeholder="Search SAT, LSAT, DECA...">

<!-- CATEGORIES -->
<div id="categories" class="grid"></div>

<!-- SUBCATEGORIES -->
<div id="subcats" class="hidden">
  <button class="btn back" onclick="showCategories()">Back</button>
  <h2 id="subcat-title"></h2>
  <div id="subcat-grid" class="grid"></div>
</div>

<!-- PRODUCTS -->
<div id="products" class="hidden">
  <button class="btn back" onclick="showSubcats()">Back</button>
  <h2 id="product-title"></h2>
  <div id="product-grid" class="grid"></div>

  <div id="admin-form" class="hidden">
    <h3>Add Product</h3>
    <input id="p-title" placeholder="Title">
    <textarea id="p-desc" placeholder="Description"></textarea>
    <input id="p-rating" type="number" step="0.5" min="0" max="5" placeholder="Rating">
    <button class="btn add" onclick="addProduct()">Add</button>
  </div>
</div>

</div>

<script>
/* =======================
   DATA
======================= */
const categories = JSON.parse(localStorage.getItem('categories')) || {
  tests: ['sat','act','lsat','psat','dsat'],
  comps: ['deca','fbla','hosa','bpa','tsa'],
  proctor: ['examity','honorlock','proctorio','proctoru'],
  cheating: []
};

let currentCat = null;
let currentSub = null;
let isAdmin = true; // set false if needed

/* =======================
   HELPERS
======================= */
function key(cat, sub) {
  return `products_${cat}_${sub}`;
}

/* =======================
   UI NAV
======================= */
function showCategories() {
  document.getElementById('categories').classList.remove('hidden');
  document.getElementById('subcats').classList.add('hidden');
  document.getElementById('products').classList.add('hidden');
}

function showSubcats() {
  document.getElementById('products').classList.add('hidden');
  document.getElementById('subcats').classList.remove('hidden');
}

/* =======================
   RENDER
======================= */
function renderCategories() {
  const el = document.getElementById('categories');
  el.innerHTML = '';
  Object.keys(categories).forEach(cat => {
    const c = document.createElement('div');
    c.className = 'card';
    c.textContent = cat.toUpperCase();
    c.onclick = () => loadSubcats(cat);
    el.appendChild(c);
  });
}

function loadSubcats(cat) {
  currentCat = cat;
  const grid = document.getElementById('subcat-grid');
  grid.innerHTML = '';
  document.getElementById('subcat-title').textContent = cat.toUpperCase();

  categories[cat].forEach(sub => {
    const c = document.createElement('div');
    c.className = 'card';
    c.textContent = sub.toUpperCase();
    c.onclick = () => loadProducts(sub);
    grid.appendChild(c);
  });

  document.getElementById('categories').classList.add('hidden');
  document.getElementById('subcats').classList.remove('hidden');
}

function loadProducts(sub) {
  currentSub = sub;
  document.getElementById('product-title').textContent =
    `${currentCat.toUpperCase()} → ${sub.toUpperCase()}`;

  const grid = document.getElementById('product-grid');
  grid.innerHTML = '';

  const products = JSON.parse(localStorage.getItem(key(currentCat, currentSub)) || '[]');

  products.forEach((p, i) => {
    const c = document.createElement('div');
    c.className = 'card';
    c.innerHTML = `<strong>${p.title}</strong><p>${p.desc}</p><small>⭐ ${p.rating}</small>`;
    if (isAdmin) {
      const del = document.createElement('button');
      del.className = 'btn delete';
      del.textContent = 'Delete';
      del.onclick = () => deleteProduct(i);
      c.appendChild(del);
    }
    grid.appendChild(c);
  });

  document.getElementById('admin-form').classList.toggle('hidden', !isAdmin);
  document.getElementById('subcats').classList.add('hidden');
  document.getElementById('products').classList.remove('hidden');
}

/* =======================
   CRUD
======================= */
function addProduct() {
  const title = document.getElementById('p-title').value;
  const desc = document.getElementById('p-desc').value;
  const rating = document.getElementById('p-rating').value;

  if (!title) return alert('Title required');

  const storageKey = key(currentCat, currentSub);
  const products = JSON.parse(localStorage.getItem(storageKey) || '[]');

  products.push({
    title,
    desc,
    rating,
    category: currentCat,
    subcategory: currentSub
  });

  localStorage.setItem(storageKey, JSON.stringify(products));
  loadProducts(currentSub);

  document.getElementById('p-title').value = '';
  document.getElementById('p-desc').value = '';
  document.getElementById('p-rating').value = '';
}

function deleteProduct(i) {
  const storageKey = key(currentCat, currentSub);
  const products = JSON.parse(localStorage.getItem(storageKey));
  products.splice(i,1);
  localStorage.setItem(storageKey, JSON.stringify(products));
  loadProducts(currentSub);
}

/* =======================
   SEARCH (FIXED)
======================= */
document.getElementById('search').addEventListener('input', e => {
  const q = e.target.value.toLowerCase();
  if (!q) return;

  for (const cat in categories) {
    for (const sub of categories[cat]) {
      if (sub.startsWith(q)) {
        currentCat = cat;
        loadProducts(sub);
        e.target.value = '';
        return;
      }
    }
  }
});

/* =======================
   INIT
======================= */
renderCategories();
showCategories();
</script>
</body>
</html>